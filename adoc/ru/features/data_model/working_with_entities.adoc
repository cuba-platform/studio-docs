:sourcesdir: ../../../../source

[[data_model_entities]]
==== Операции над сущностями

[[data_model_entity]]
Создание новой сущности::
+
--
. Выберите элемент *Data Model* или вложенный в него пакет в дереве проекта и в контекстном меню нажмите *New > Entity*.

. В появившемся окне *New CUBA Entity* введите имя класса сущности в поле *Entity name*, выберите тип сущности и её идентификатор.

. Studio создаст класс сущности и зарегистрирует его в файле `persistence.xml` или `metadata.xml` в зависимости от типа сущности. Созданный класс откроется в редакторе исходного кода.

Studio отображает четыре вкладки в нижней части экрана редактирования исходного кода сущности. Вместе они составляют визуальный дизайнер сущностей:

* *Text* содержит исходный код класса.

* *Designer* показывает структуру сущности, здесь вы можете настроить сущность и её атрибуты с помощью графического интерфейса без необходимости написания Java-кода вручную.

* *Indexes* отображает и позволяет создавать новые индексы для выбранной сущности.

* *DDL Preview* отображает доступный только для чтения DDL-код таблиц сущности и её ограничений по внешнему ключу.

image::features/data_model/entity_designer.png[align="center"]

[TIP]
====
Дизайнер сущностей доступен только для пользователей с активной подпиской CUBA Studio.
====

--

[[data_model_attribute]]
Создание атрибутов сущности::
+
--
Есть несколько способов добавления атрибутов сущности.

* С помощью графического интерфейса дизайнера сущности: переключитесь на вкладку *Designer*, нажмите *New* под таблицей *Attributes* и заполните необходимые поля в окне редактора *New Attribute*.
+
Кнопка "глобус" в правой части поля *Name* поможет сразу же задать удобочитаемое имя атрибута для пользовательского интерфейса. Оно будет храниться в файле `messages.properties` и использоваться по умолчанию в компонентах UI. Если ваше приложение поддерживает несколько языков, вы также можете задать локализованное имя атрибута для каждого языка.
+
image::features/data_model/attribute_l10n.png[align="center"]

* В отдельном окне, открываемом из исходного кода класса сущности. Поместите курсор под последним существующим полем класса и нажмите Alt+Insert (Cmd+N). В меню *Generate* выберите *Add Attribute*. Studio отобразит окно *New Attribute*, как если бы оно было открыто из визуального дизайнера.
Это же окно откроется, если нажать кнопку *Add attribute* на панели действий в редакторе исходного кода сущности.
+
image::features/data_model/new_attribute_2.png[align="center"]

* Вы можете создать поле атрибута и вручную, сгенерировать для него геттер и сеттер, а затем выбирать *JPA Annotations* в меню *Generate*, чтобы добавить JPA-аннотации с параметрами по умолчанию.

Studio поможет добавить новые атрибуты к уже существующим экранам, содержащим данную сущность. Откройте вкладку *Text* и нажмите на кнопку *Add attributes to screens*, расположенную в верхней панели действий редактора исходного кода. Studio найдет все экраны, работающие с текущей сущностью, и проанализирует, какие атрибуты могут быть добавлены к их UI компонентам. Вы сможете выбрать желаемые атрибуты и компоненты в диалоге:

image::features/data_model/add_attrs_to_screens.png[align="center"]

Другая кнопка *Add to Screens* с похожей функциональностью расположена во вкладке *Designer* над таблицей *Attributes*.

--

[[data_model_name_pattern]]
Создание имени экземпляра сущности::
+
--
Для сущностей, которые будут использоваться в качестве ссылочных атрибутов других сущностей (как, например, `Customer` может быть атрибутом сущности `Order`), необходимо задать шаблон для генерации осмысленного имени экземпляра этих сущностей. Этот шаблон задаётся с помощью аннотации {main_man_url}/entity_class_annotations.html#namePattern_annotation[@NamePattern] класса сущности. Аннотацию можно создать средствами Studio, для этого нужно поместить курсор на название класса, нажать Alt+Enter (Option+Enter) и выбрать *Add name pattern* (этот пункт доступен только для тех классов, для которых аннотация `@NamePattern` ещё не задана):

image::features/data_model/create_name_pattern.png[align="center"]

Нажмите Enter, и Studio отобразит список всех имеющихся атрибутов сущности. Выберите один или несколько атрибутов и нажмите Enter, после чего Studio сгенерирует аннотацию `@NamePattern` над классом сущности.
--

[[data_model_messages]]
Создание строк сообщений для новых атрибутов::
+
--
Когда вы создаёте новые атрибуты вручную, их имена будут подсвечены, чтобы вы не забыли создать удобочитаемые имена атрибутов в соответствующем пакете сообщений:

image::features/data_model/create_message_1.png[align="center"]

Нажмите Alt+Enter (Option+Enter) на выделенном атрибуте и выберите пункт *Create message in the message bundle*:

image::features/data_model/create_message.png[align="center"]
--

[[entity_ddl_generation_settings]]
Настройки генерации DDL::
--
На вкладке *Designer* редактора сущности вы можете задать <<migration_entity_ddl_settings,настройки генерации DDL>>, которые влияют на генерацию скриптов миграции БД для выбранной сущности.
--

[[remove_entity]]
Удаление сущностей::
+
--
При удалении класса сущности используйте опцию *Safe delete* для того, чтобы найти и удалить ссылки на данную сущность:

image::features/data_model/remove_entity.png[align="center"]

Некоторые ссылки, например в файлах `persistence.xml` и `metadata.xml`, будут удалены автоматически. При наличии других ссылок, будет показан диалог, в котором они будут перечислены. Нажмите в нем *View Usages*, просмотрите ссылки в окне инструментов *Find* и нажмите *Cancel* или *Do Refactor*.
--