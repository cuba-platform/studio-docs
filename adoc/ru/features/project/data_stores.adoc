:sourcesdir: ../../../../../source

[[data_stores]]
==== Управление хранилищами данных

Основное хранилище данных::
+
--
Диалог *Main Data Store Properties* отображает настройки основного хранилища данных проекта.
Его можно открыть:

* двойным кликом мыши по пункту *Project* -> *Data Stores* -> *Main Data Store* в дереве проекта CUBA
* через главное меню: *CUBA* -> *Main Data Store Settings...*

Тип сервера базы данных можно выбрать в поле *Database type*.
В полях ниже вы можете настроить URL подключения к базе данных, указать имя пользователя, пароль и дополнительные параметры подключения.

Формат параметров подключения зависит от типа выбранной СУБД. Строка параметров должна содержать разделитель между именем базы данных и непосредственно параметрами.
К примеру, чтобы указать имя экземпляра Microsoft SQL Server 2008+, нужно ввести в поле следующую строку:
[source]
----
;instanceName=myinstance
----

Нестандартный URL подключения к БД можно указать в случае, если установлен флажок *Custom database URL*.
В этом случае необходимо также указать значения *Host* и *Database*, так как в скрипте `build.gradle` эти значения используются по отдельности.

Если выбрана HSQLDB, Studio сама обеспечит создание и подключение к БД. Созданные файлы БД будут сохранены в каталог `build/hsqldb`.
--

[[data_stores_additional]]
Дополнительные хранилища данных::
+
--

Чтобы создать {main_man_url}/data_store.html[дополнительное хранилище данных] в проекте,
кликните правой кнопкой мыши по элементу *Data Stores* в дереве проекта CUBA и выберите пункт контекстного меню *New* -> *Additional Data Store*.
Дополнительные хранилища данных, зарегистрированные в проекте, отображаются как подпункты секции *Data Stores*:

image::features/project/additional-stores.png[align="center"]

Правый клик мыши по пункту дополнительного хранилища открывает контекстное меню:

* *Delete Data Store* - удалить хранилище данных из проекта
* *Edit Data Store* - открыть диалог редактирования настроек хранилища
* *Generate Model...* - <<generate_model,сгенерировать модель данных>> по выбранному хранилищу

При создании и редактировании дополнительного хранилища открывается диалоговое окно *Data Store*. Оно содержит следующие поля:

* *Data store name* - имя хранилища данных. Может содержать только буквенно-числовые символы и нижние подчеркивания, а также должно отличаться от имени проекта.
* *Data store type* - тип хранилища: `RdbmsStore` или `Custom`, более подробно см. в основном {main_man_url}/data_store.html[Руководстве].
В случае, если выбран тип `RdbmsStore`, необходимо также заполнить следующие поля, описанные ниже.
* *DataSource JNDI name* - устанавливается автоматически в Studio на основе имени хранилища.
* *Database type*, *URL*, и т.д. - параметры подключения к БД.

image::features/project/add-store-settings.png[align="center"]

--
[[data_stores_db_scripts]]
Скрипты создания и обновления БД::
+
--
{main_man_url}/db_scripts.html[Скрипты создания и обновления БД] доступны для основного хранилища и отображаются внутри его элемента *Main Data Store* в дереве проекта:

image::features/project/db-scripts.png[align="center"]

* Скрипты *создания* (init) БД содержат DDL и DML операторы, создающие БД с нуля и до состояния схемы, сооветствующего текущему состоянию модели данных.
* Скрипты *обновления* (update) БД содержат операторы, которые обновляют уже существующую структуру БД с какого-то из предыдущих состояний до состояния, соответствующего текущему состоянию модели данных.

Studio автоматически поддерживает скрипты создания и обновления БД на основании изменения модели данных, подробнее это описано в секции <<database_migration>>.

Вы также можете создавать дополнительные скрипты БД, если это необходимо. Используйте следующие действия в дереве проекта CUBA, в секции *Data Stores* -> *Main Data Store*:

* init -> контекстное меню -> *New* -> *Database init script*
* update -> контекстное меню -> *New* -> *Database update script*

image::features/project/new-update-script.png[align="center"]

--
