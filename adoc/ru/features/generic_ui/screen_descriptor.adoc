:sourcesdir: ../../../../source

[[screen_descriptor]]
==== Работа с дескриптором экрана

Редактор {main_man_url}/screen_descriptors.html[XML-дескриптора экрана] интегрирован с *дизайнером экранов*. Дизайнер экранов представляет из себя несколько панелей и боковых панелей IDE (tool window), позволяющих создавать верстку экрана и устанавливать свойства компонентов визуальным образом. Вы можете редактировать XML напрямую или использовать панели дизайнера для генерации кода.

Дизайнер экранов состоит из следующих панелей:

* *Редактор исходного кода* - позволяет редактировать исходный XML код.
* *Верхняя панель действий* - предоставляет несколько действий для быстрого доступа.
* *Панель предпросмотра верстки* (*Preview*) - отображает схематичное интерактивное представление верстки экрана.
* *Панель иерархии компонентов* (*Component Hierarchy*) - отображает иерархию элементов экрана в виде дерева.
* *Панель палитры компонентов* (*Component Palette*) - отображает набор доступных компонентов, которые можно добавить в текущий экран.
* *Панель свойств компонента* (*Component Inspector*) - отображает и позволяет редактировать свойства компонента и генерировать обработчики событий, связанные с ним.

[TIP]
====
Панели дизайнера экранов доступны только для пользователей с активной подпиской CUBA Studio.
====

image::features/generic_ui/screen_designer.png[align="center"]

[[screen_descriptor_actions_panel]]
Верхняя панель действий::
+
--
Панель действий расположена в верхней части редактора исходного кода. Она содержит следующие действия:

* *Controller* - перейти к контроллеру экрана.
* *<название класса сущности>* - отображается, если данный экран является экраном просмотра/выбора или редактором сущности. Позволяет перейти к классу сущности, связанной с данным экраном.

Также можно переключаться между дескриптором и контроллером экрана с помощью специального маркера в жёлобе Studio.

--

[[screen_descriptor_tool_windows]]
Боковые панели дизайнера::
+
--
Панели *Component Hierarchy*, *Component Palette* и *Component Inspector* реализованы как независимые боковые панели IDE (tool window). Эти панели автоматически появляются, когда вы открываете дескриптор экрана в редакторе. Когда вы переключаете активный файл дескриптора экрана, содержимое боковых панелей обновляется. Иногда, когда вы открываете другие боковые панели IDE (такие как Gradle, Persistence и т.д.), панели дизайнера экранов скрываются, и вы можете переоткрыть их, кликнув по соответствующим кнопкам на левой и правой кромках окна IDE.

Также есть возможность отображать панель *Component Inspector* в нижнем правом углу окна IDE, для тех пользователей, кто предпочитает старую компоновку, использовавшуюся в предыдущих версиях CUBA Studio. Чтобы переместить эту панель направо, нажмите кнопку *Move to Right Bottom*, расположенную в заголовке панели.

Панели дизайнера остаются активными и при редактировании XML кода. Опытные разработчики, которые просматривают и меняют дескрипторы экранов прямым редактированием XML кода, также могут воспользоваться возможностями панелей дизайнера экранов. Вы можете добавлять компоненты из палитры в панель иерархии, переупорядочивать компоненты и редактировать свойства компонентов в панели *Component Inspector*, когда в редакторе открыт исходный код. Все изменения немедленно применяются к исходному коду.
--

[[screen_descriptor_layout_preview]]
Панель предпросмотра верстки::
+
--
Панель предпросмотра верстки (*Preview*) отображает схематичное интерактивное представление верстки экрана. Она разделяет пространство редактора с исходным кодом дескриптора экрана. В правой части верхней панели дескриптора экрана находятся четыре кнопки, которые переключают режим отображения предпросмотра:

* *Editor only* - редактор содержит только исходный код.
* *Editor and Preview* - пространство редактора разделено пополам между исходным кодом и панелью предпросмотра.
* *Preview only* - весь редактор занят панелью предпросмотра.
* *Preview in Window* - редактор содержит исходный код, а панель предпросмотра выделена в независимое окно, которое можно переместить на другой монитор.

image::features/generic_ui/layout_preview_modes.png[align="center"]

В верхней правой части панели также находятся несколько элементов управления:

image::features/generic_ui/layout_preview_controls.png[align="center"]

* Выпадающий список *100% x 100%* позволяет вам выбрать фиксированный размер канвы. Размер канвы может быть больше, чем размер панели предпросмотра, в этом случае добавляются дополнительные полосы прокрутки. Например если вы разрабатываете сложный экран с большим количеством компонентов и хотите оценить предварительный вид экрана, вы можете выбрать размер канвы *1920 x 1080* и увидеть, как верстка выглядит на большом экране.
* Кнопка *Refresh* перезагружает содержимое страницы предпросмотра.
* Кнопки *Zoom In*, *Zoom Out* и *Zoom Reset* изменяют масштаб на странице предпросмотра.
* Самая правая иконка отображает результаты автоматической фоновой проверки проблем расположения компонентов на экране. Наведите курсор мыши на иконку, чтобы увидеть список обнаруженных проблем.

В рабочей области панели предпросмотра вы также можете располагать компоненты, изменять их размер и задавать выравнивание с помощью элементов управления:

* расширить горизонтально,
* расширить вертикально,
* выровнять по вертикали/горизонтали.


image::features/generic_ui/layout_component_controls.png[align="center"]

--

[[screen_descriptor_palette]]
Палитра компонентов::
+
--
Панель палитры компонентов (*Component Palette*) расположена в нижнем правом углу IDE. Она отображает набор доступных элементов экрана:

* Контейнеры (Containers);
* Компоненты (Components);
* Компоненты данных (Data components): контейнеры и загрузчики;
* Невизуальные элементы (Non-visual): действия, настройки диалогового окна, таймеры и другие вспомогательные элементы экрана;
* Главный экран (Main window): составные компоненты главного экрана приложения.

Компоненты в палитре можно искать по имени с помощью текстового поля поиска.

Чтобы добавить компонент на экран, перетащите его из палитры в панель иерархии компонентов.

Правый клик мыши по компоненту в палитре открывает контекстное меню со следующими действиями:

* *Add to Design* - добавляет выбранный компонент на экран, помещая его в место, соответствующее выбранному элементу иерархии.
* *CUBA Documentation* - открывает страницу документации по выбранному компоненту в руководстве разработчика.

image::features/generic_ui/component_palette.png[align="center"]

--

[[screen_descriptor_hierarchy]]
Панель иерархии компонентов::
+
--
Панель иерархии компонентов (*Component Hierarchy*) расположена в верхнем правом углу окна IDE. Она отображает дерево элементов экрана.

Элементы дерева можно перетаскивать с места на место.

Правый клик мыши по элементу иерархии открывает контекстное меню:

* *Convert* - конвертировать компонент в один из похожих альтернативных компонентов.
* *Wrap* - обернуть компонент в один из предлагаемых контейнеров.
* *Go to XML* - перейти к XML тегу в исходном коде.
* *Inject* - инжектировать элемент в контроллер экрана или перейти к уже существующему определению в классе контроллера.
* *Delete*, *Copy*, *Cut*, *Paste* - удалить, скопировать, вырезать, вставить элемент.
* *CUBA Documentation* - открыть страницу документации для выбранного компонента.

image::features/generic_ui/component_hierarchy.png[align="center"]

--

[[screen_descriptor_inspector]]
Панель свойств компонента::
+
--
Панель свойств компонента (*Component Inspector*) расположена в нижнем левом углу окна IDE. Она отображает и позволяет редактировать свойства выбранного элемента экрана:

* Вкладка *Properties* отображает свойства компонента.
* Вкладка *Handlers* отображает слушатели событий и методы-делегаты, которые могут быть созданы для выбранного в дереве иерархии компонента. Чтобы сгенерировать необходимый метод-обработчик - просто выполните двойной клик по соответствующей строчке.

Вы можете искать атрибуты по имени с помощью поля поиска:

image::features/generic_ui/component_inspector.png[align="center"]

Для некоторых видов выбранных элементов панель отображает кнопку *+ Add*, которая позволяет быстро добавить связанные по смыслу под-элементы, такие как действие таблицы, столбец таблицы или поле формы. Если выбранный элемент - это:

* `Table`, `Grid` или их действия или колонки - то доступны действия *Add* -> *Column*, *Add* -> *Group*, *Add* -> *Action*.
* `Form` или колонка или поле формы - доступны действия *Add* -> *Column*, *Add* -> *Field*.
* `DataLoadCoordinator` - доступно действие *Add* -> *onScreenEvent trigger* и другие триггеры.

image::features/generic_ui/component_inspector_add_button.png[align="center"]

--


[[screen_descriptor_inspections]]
Статический анализ кода (Inspections)::
+
--
Studio непрерывно проводит фоновый статический анализ кода разметки экрана на предмет ошибок и несоответствий, проверяет внутренние и внешние ссылки. В случае обнаружения следующих проблем Studio покажет специальное предупреждение или подчеркнёт проблемный элемент в XML-коде:

* Экран не может быть собран из-за ошибки в разметке XML.
* Ссылка на сущность или её свойство, используемая компонентом, не соответствует реальной модели данных приложения.
* Есть конфликт размеров компонентов: учитываются значения атрибутов `width`, `height` и `expand`.
* Значения атрибутов `dataContainer` и `dataLoader` не ссылаются ни на один из имеющихся контейнеров или загрузчиков.
* Для полей внутри элемента `form` явно не определён XML-атрибут `property`: в этом случае для ссылки на поле сущности будет неявно использовано значение атрибута `id`.
* Семантическая ошибка в элементе `form`: поля дублируются или располагаются не внутри вложенного элемента `column`.
* Количество столбцов `gridLayout` не соответствует заявленному количеству.
* Дублирование атрибута в расширенном экране, когда один и тот же атрибут объявлен и в родительском, и в дочернем экране.
* Имена элементов в дочернем экране не соответствуют аналогичным элементам в родительском экране, либо их расположение некорректно.
* Значение атрибута `messagesPack` не ссылается на реально существующий пакет сообщений, содержащий как минимум один файл `messages_xx.properties`.
* Ссылка на схему XSD устарела.
* Значения идентификаторов элементов не уникальны внутри данного экрана.
* и другие проблемы.

Инспекции CUBA можно настроить в окне *Settings* (*File > Settings > Editor > Inspections*).
--

[[screen_descriptor_intentions]]
Намерения (Intentions) и меню Generate::
+
--
Intention-действие ("намерение") - это контекстно зависимое действие (зависит от позиции курсора), которое может быть запущено разработчиком из редактора исходного кода по нажатию Alt+Enter (Option+Enter). Intention-действия помогают с рефакторингами, генерацией кода, навигацией по коду и другими задачами. Вы можете прочитать больше об intention-действиях здесь: https://www.jetbrains.com/help/idea/intention-actions.html.

Меню *Generate* содержит контекстно зависимые действия, помогающие генерировать различные конструкции кода. Это меню может быть вызвано из редактора исходного кода нажатием Alt+Insert (Cmd+N). Дополнительная информация об этом меню находится здесь: https://www.jetbrains.com/help/idea/generating-code.html.

Многие intention-действия и элементы меню Generate, встроенные в Studio, помогают работать с компонентами экранов. Используйте Alt+Insert (Cmd+N) и Alt+Enter (Option+Enter), чтобы исследовать возможности работы с конкретными компонентами UI и источниками данных.

. Например, чтобы добавить новое поле в компонент {main_man_url}/gui_Form.html[Form], вы можете поместить курсор во внутрь элемента `form` и выполнить одно из следующих действий:
+
* Нажать Alt+Insert (Cmd+N), выбрать *Add field*, а затем выбрать значение атрибута `property`,
+
image::features/generic_ui/gui_Form_add.png[align="center"]

* Ввести `field` и нажать TAB, затем выбрать значение атрибута `property`.
+
image::features/generic_ui/gui_Form_add_tab.png[align="center"]

. Другой пример - добавление локализованной подписи к одному из компонентов. Вы можете набрать в исходном коде ключ локализованного сообщения, которое ещё не существует. Указывающий на сообщение элемент окажется подсвечен красным цветом. Затем нажмите Alt+Enter (Option+Enter) и выберите *Create message in the message bundle*:
+
image::features/generic_ui/intention_add_localized_message.png[align="center"]

--
