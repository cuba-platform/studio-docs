:sourcesdir: ../../../../source

[[generate_model]]
==== Генерация модели данных

Studio позволяет легко создавать модель данных приложения и стандартные экраны UI поверх существующей базы данных. Нажмите *CUBA > Advanced > Generate Model* в главном меню или выберите *Project > Data Stores* в дереве проекта и нажмите *Generate Model* в контекстном меню. Если приложение подключено к нескольким хранилищам данных, выберите один из них в отобразившемся окне Studio.

После этого Studio запустит мастер генерации модели *Generate Model from Database*.

Шаг 1::
+
--
Это первый шаг генерации модели данных с помощью мастера.

image::features/data_model/generate_model_step1.png[align="center"]

Дополнительный шаг: вы можете нажать на кнопку image:gear_button.png[Settings], чтобы выбрать пакет Java, в который нужно поместить новые сущности, и настроить сопоставление (mapping) системных атрибутов по умолчанию.

К примеру, если все или большинство таблиц в вашей базе данных содержат столбцы `Modified` и `ModifiedBy`, вы можете сопоставить их с атрибутами `Updatable.updateTs` и `Updatable.updatedBy` для всех генерируемых сущностей. В этом случае вам не придётся настраивать сопоставление этих атрибутов индивидуально для каждой сущности. Используйте список *Exclude columns from mapping*, если вы хотите исключить некоторые столбцы из автоматического сопоставления для всех таблиц.

Мастер отображает список таблиц, для которых не найдены соответствующие сущности в модели данных. Используйте поле фильтра, чтобы найти нужную таблицу по её имени.

Выберите таблицы, которые вы хотите отразить в своей модели данных. Некоторые таблицы могут быть связаны с другими через внешние ключи, и когда вы выбираете такую таблицу, все связанные с ней таблицы выбираются автоматически. Если снимаете выделение с такой таблицы, все зависимые таблицы также становятся невыбранными.

Чекбокс справа поможет выбрать или снять выбор сразу со всех доступных таблиц.

Нажмите *Next*.
--

Шаг 2::
+
--
На этом шаге вы можете просмотреть и отредактировать сопоставление атрибутов, которое было создано автоматически для выбранных таблиц.

image::features/data_model/generate_model_step2.png[align="center"]

В столбце *Status* отображается результат автоматического сопоставления:

* *OK* - автоматическое сопоставление прошло успешно, все столбцы полностью отражены в новых сущностях.
* *Join table* - связь между сущностями распознана и отражена в виде связанной таблицы many-to-many.
* *There are unmapped columns* - некоторые столбцы не могут быть отражены в новых сущностях.
* *New PK will be created* - таблица не имеет первичного ключа. Будет создан новый первичный ключ с типом UUID.
* *Composite PK will be replaced* - таблица имеет составной первичный ключ, но на него нет ссылок из других таблиц. Составной первичный ключ будет заменён первичным ключом с типом UUID.
* *Composite PK referenced by other tables* - таблица имеет составной первичный ключ, на который ссылаются другие таблицы. Studio не может сопоставить такую таблицу.
* *Unsupported PK type* - таблица имеет первичный ключ неподдерживаемого типа. Studio не может сопоставить такую таблицу.
* *Choose primary key for DB view* - данная таблица является представлением (view), и вы должны выбрать один или несколько столбцов, которые будут использованы в качестве идентификатора сущности. Для этого нажмите кнопку *Choose PK* и выберите столбцы для первичного ключа.

Кнопка image:refresh_button.png[Refresh mapping] позволяет заново выполнить автоматическое сопоставление для выбранных таблиц. Таким образом, вы можете, к примеру, внести изменения в схему БД в некоем стороннем клиенте баз данных, а затем вернуться в мастер Studio и перезапустить процедуру сопоставления.

Кнопка image:edit_button.png[Edit mapping] открывает диалоговое окно, в котором отображаются подробности данного сопоставления. Здесь вы можете изменить имя будущей сущности и список системных интерфейсов, которые должен реализовывать класс сущности. Это влияет на количество системных столбцов, которые будут созданы в базе данных в целях совместимости с сущностями платформы.

image::features/data_model/generate_model_step2_2.png[align="center"]

Кнопка *Choose PK* появляется вместо кнопки *Edit mapping*, если выбрано представление (view) базы данных, и требуется отметить столбцы, которые будут использованы в качестве идентификатора сущности.

Нажав *Back*, вы можете вернуться к предыдущему шагу и изменить список выбранных таблиц.

Нажмите *Next*, чтобы перейти к следующему шагу.
--

Шаг 3::
+
--
На этом этапе вы можете указать, какие экраны пользовательского интерфейса необходимо создать для новых сущностей.

image::features/data_model/generate_model_step3.png[align="center"]

Если вы снимете флажок *Create standard screen*, Studio не будет генерировать экраны UI для новых сущностей.

Используйте поля *In module*, *Package* и *Menu*, чтобы указать, где должен быть размещён исходный код создаваемых экранов и в какой части меню приложения они должны отображаться.

Используйте выпадающий список в столбце *Standard screens*, чтобы выбрать тип создаваемых экранов.

Вы можете спокойно пропустить этот шаг и создать экраны позднее, после завершения генерации модели данных.

Нажмите *Next*, чтобы перейти к следующему шагу.
--

Шаг 4::
+
--
Этот шаг завершает процесс генерации модели данных.

//TODO insert screenshot

Таблица *Import scripts* содержит список скриптов, которые необходимо выполнить в базе данных, чтобы сделать её совместимой с создаваемыми сущностями.

До этого этапа никаких изменений не было ни внесено в проект, ни даже сохранено на диск. По факту, Studio выполняет генерацию сущностей и экранов и сохраняет скрипты только после того, как вы нажмёте *Run all scripts* или *Run script*.

Вы можете просмотреть и отредактировать скрипты на этой странице, затем выполнить их или просто сохранить, чтобы выполнить позднее в любой отдельной утилите для управления базами данных. Скрипты импорта сохраняются в папку проекта `modules/core/db/import`.
--