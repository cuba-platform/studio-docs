:sourcesdir: ../../../../source

[[database_migration]]
==== Database Migration

Studio is capable of creating DDL scripts for keeping your database schema up-to-date with the project's data model. The generated scripts can be executed either from Studio, directly by {main_man_url}/db_update_gradle.html[Gradle tasks] or by the application itself {main_man_url}/db_update_server.html[on startup].

In order to start generation of DDL scripts, click *CUBA > Generate Database Scripts* in the main menu or select *Data Model* in the project tree and click *Generate Database Scripts* in the context menu.

Studio will open the *Database Scripts* window with the following tabs:

Updates::
+
--
The *Updates* tab displays scripts for updating the database to the current state of the data model. Saved scripts are located in the `modules/core/db/update` directory. The scripts have autogenerated names with prefixes that ensure the order of execution. Scripts containing DROP statements are highlighted in red.

You can add an arbitrary script by clicking the image:plus_button.png[Create] button, and it will be saved and executed later together with auto-generated scripts.

The newly generated scripts can be edited or completely deleted by clicking the image:remove_button.png[Remove] button.

If you click image:exclude_button.png[Exclude selected] (exclude), you will have two options:

* Move the script to the directory of manually executed scripts: `modules/core/db/update-manually`. Then the script will not be executed automatically when you run *Update database*, but you will be able to run it manually when needed. This option is useful for scripts that drop columns or tables renamed earlier to `*__UNUSED`.
* Exclude the script: it will not be saved to the `modules/core/db/update` directory, but remembered in the `studio-intellij.xml` file in your project folder. When you generate scripts next time, Studio will ignore changes, corresponding to the excluded scripts. This allows you to have differences between the database and the model entities.
+
For example, you may want to add a database field to a table, corresponding to a project entity, but do not map it to an entity attribute. When Studio generates a script to delete the field from the database, just exclude it, and Studio will never generate it again.
--

Init Tables::
+
--
The *Init Tables* script creates all tables when you execute *Create Database*. It is executed before the *Init constraints* and *Init data* scripts. You can edit the script, but keep the comments dividing tables. The script is saved into the `10.create-db.sql` file.
--

Init Constraints::
+
--
The *Init Constraints* script creates referential integrity constraints. It is executed immediately after the *Init tables* script. You can edit the script, but keep the comments dividing tables. The script is saved into the `20.create-db.sql` file.
--

Init Data::
+
--
The *Init Data* script allows you to insert additional data or schema information not present in the data model. It is executed at the end of initialization. The script is saved into the `30.create-db.sql` file.
--

If the project contains an application component (add-on) that does not provide DDL scripts for the current database, Studio generates scripts for this component and shows them in the *Init {component} tables* and *Init {component} constraints* tabs. The scripts are saved in `01.{component}-create-db.sql` and `02.{component}-create-db.sql` files respectively.

Click *Save and close* to save all generated scripts. You can find the scripts in the *Project > Data Stores > Main Data Store* project tree section.

In order to run the update scripts, stop the application server if it is running and execute *Update Database* from the *CUBA* main menu. If you want to re-create the database from scratch with the init scripts, execute *Create Database*.
