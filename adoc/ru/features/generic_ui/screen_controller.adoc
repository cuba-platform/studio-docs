:sourcesdir: ../../../../source

[[screen_controller]]
==== Работа с контроллером экрана

Данный раздел посвящён возможностям Studio для работы с кодом {main_man_url}/screen_controllers.html[контроллеров экранов].

Специальные значки в жёлобе Studio позволяют быстро переключаться между дескриптором и контроллером экрана, позиционировать курсор на нужном XML-элементе инжектированного компонента и т.д.

image::features/generic_ui/controller.png[align="center"]

[[controller_action_panel]]
Верхняя панель действий::
+
--
Панель действий расположена в верхней части редактора исходного кода класса. Она отображает следующие действия:

* *Descriptor* - перейти к соответствующему дескриптору экрана.
* *<название класса сущности>* - перейти к сущности, связанной с текущим экраном, если это экран просмотра/выбора или редактор сущности.
* *Main Menu* - добавить текущий экран в главное меню или перейти к настройкам уже добавленного пункта меню.
* *Inject* - инжектировать зависимости в класс контроллера экрана, см. ниже.
* *Generate Handler* - подписать контроллер на различные события и сгенерировать методы-делегаты компонентов, см. ниже.

--

[[controller_injection]]
Инжекция зависимостей::
+
--
Механизм Dependency injection - это основной способ получения ссылок на визуальные компоненты и элементы API в коде контроллера экрана. Конечно, вы можете описать поле нужного типа и аннотировать его вручную, но Studio предоставляет возможность выбрать нужный объект из списка в специальном окне, чтобы создать требуемое поле автоматически. Это окно можно открыть:

* выбрав действие *Inject* из верхней панели действий,
* или нажав Alt+Insert (Cmd+N), далее нужно выбрать пункт *Inject...* в выпадающем меню *Generate*:

image::features/generic_ui/controller_injection.png[align="center"]

Инжектировать в контроллеры можно следующие объекты:

* Визуальные компоненты и компоненты данных, определенные в XML-дескрипторе,
* Интерфейсы API экранов,
* Интерфейсы инфраструктуры,
* Сервисы среднего слоя,
* Прочие Spring-бины, определенные в проекте,
* Интерфейсы конфигурации,
* Экземпляр SLF4J Logger.
--

[[controller_events_delegates]]
Обработчики событий и делегаты::
+
--
Существуют два способа добавить в контроллер экрана логику, связанную с жизненным циклом экрана и поведением компонентов: обработчики событий и делегаты действий компонентов. Эти два способа реализованы по-разному во фреймворке, но используются похожим образом в интерфейсе Studio.

Создав обработчик некоего события, вы можете выполнять его код на разных этапах жизненного цикла экрана, например, реагировать на действия пользователя. Обработчик представляет собой отдельный метод в контроллере экрана с аннотацией `@Subscribe`, принимающий событие в качестве параметра.

Используя делегаты, вы можете написать код, который должен использоваться различными механизмами экранов вместо их стандартной реализации. К примеру, вы можете написать свою собственную функцию для сохранения изменённых данных или переопределить значки для строк таблицы. Делегат представляет собой метод контроллера экрана со специальной сигнатурой и аннотацией `@Install`.

Обработчики событий и методы-делегаты можно создать в Studio:

* кликнув действие *Generate Handler* из верхней панели действий,
* или нажав Alt+Insert (Cmd+N) и выбрав *Generate Handler* в меню *Generate*:

image::features/generic_ui/generate_handler_dialog.png[align="center"]

Каждое событие или делегат в отобразившемся окне снабжены описанием Javadoc в правой части окна.

В окне доступны следующие события и делегаты:

* Обработчики контроллера экрана - для управления жизненным циклом экрана.

* Обработчики компонентов, позволяющие реагировать на нажатия кнопок, выбор строк в таблице, заданные действия и т.п.

* Обработчики фрейма для управления жизненным циклом внешнего фрейма, в который включён данный экран.

* Обработчики контекста данных, позволяющие реагировать на изменения data context и выполнять код до и после сохранения данных в экране.

* Обработчики контейнеров данных, которые могут получать уведомления об изменении состояний контейнеров данных и хранимых в них сущностей.

* Обработчики загрузчиков данных, позволяющие реализовать собственную или кастомизировать стандартную логику загрузки данных для компонентов экрана.
--
