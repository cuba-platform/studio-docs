:sourcesdir: ../../../../source

[[screen_controller]]
==== Работа с контроллером экрана

Данный раздел посвящён возможностям Studio для работы с кодом {main_man_url}/screen_controllers.html[контроллеров экранов].

Специальные значки в жёлобе Studio позволяют быстро переключаться между дескриптором и контроллером экрана, позиционировать курсор на нужном XML-элементе инжектированного компонента и т.д.

image::features/generic_ui/controller.png[align="center"]

[[controller_action_panel]]
Верхняя панель действий::
+
--
Панель действий расположена в верхней части редактора исходного кода класса. Она отображает следующие действия:

* *<название класса сущности>* - перейти к сущности, связанной с текущим экраном, если это экран просмотра/выбора или редактор сущности.
* *Descriptor* - перейти к соответствующему дескриптору экрана
* *Main Menu* - добавить текущий экран в главное меню или перейти к настройкам уже добавленного пункта меню.
* *Inject* - инжектировать зависимости в класс контроллера экрана, см. ниже.
* *Subscribe to Event* - подписать контроллер на различные события, см. ниже.
* *Install Delegate* - генерировать методы-делегаты компонентов, см. ниже.

--

[[controller_injection]]
Инжекция зависимостей::
+
--
Механизм Dependency injection - это основной способ получения ссылок на визуальные компоненты и элементы API в коде контроллера экрана. Конечно, вы можете описать поле нужного типа и аннотировать его вручную, но Studio предоставляет возможность выбрать нужный объект из списка в специальном окне, чтобы создать требуемое поле автоматически. Это окно можно открыть:

* выбрав действие *Inject* из верхней панели действий,
* или нажав Alt+Insert (Cmd+N), далее нужно выбрать пункт *Inject...* в выпадающем меню *Generate*:

image::features/generic_ui/controller_injection.png[align="center"]

Инжектировать в контроллеры можно следующие объекты:

* Визуальные компоненты и компоненты данных, определенные в XML-дескрипторе,
* Интерфейсы API экранов,
* Интерфейсы инфраструктуры,
* Сервисы среднего слоя,
* Прочие Spring-бины, определенные в проекте,
* Интерфейсы конфигурации,
* Экземпляр SLF4J Logger.
--

[[controller_events]]
Обработка событий::
+
--
Создав обработчик некоего события, вы можете выполнять его код на разных этапах жизненного цикла экрана, например, реагировать на действия пользователя. Обработчик представляет собой отдельный метод в контроллере экрана с аннотацией `@Subscribe`, принимающий событие в качестве параметра. Такой метод можно создать в Studio:

* кликнув действие *Subscribe to Event* из верхней панели действий,
* или нажав Alt+Insert (Cmd+N) и выбрав *Subscribe to Event* в меню *Generate*:

image::features/generic_ui/subscribe_dialog.png[align="center"]

Каждое событие в отобразившемся окне снабжено описанием Javadoc в правой части окна.

По умолчанию в окне доступны следующие события:

* События контроллера для управления жизненным циклом экрана.

* События компонентов, позволяющие реагировать на нажатия кнопок, выбор строк в таблице, заданные действия и т.п.

* События фрейма для управления жизненным циклом внешнего фрейма, в который включён данный экран.

* События контекста данных, позволяющие реагировать на изменения data context и выполнять код до и после сохранения данных в экране.

* События контейнеров данных, которые могут получать уведомления об изменении состояний контейнеров данных и хранимых в них сущностей.
--

[[controller_delegates]]
Делегаты::
+
--
Используя делегаты, вы можете написать код, который должен использоваться различными механизмами экранов вместо их стандартной реализации. К примеру, вы можете написать свою собственную функцию для сохранения изменённых данных или переопределить значки для строк таблицы.

Делегат представляет собой метод контроллера экрана со специальной подписью и аннотацией `@Install`. Такой метод также можно создать в Studio:

* кликнув действие *Install Delegate* из верхней панели действий,
* или нажав Alt+Insert (Cmd+N) и выбрав *Install Delegate* в меню *Generate*:

image::features/generic_ui/install_dialog.png[align="center"]

Каждый делегат в отобразившемся окне снабжён описанием Javadoc в правой части окна.
--
